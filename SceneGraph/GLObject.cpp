#include "GLObject.h"

namespace SceneGraph
{

std::map<int,GLObject*> GLObject::g_mObjects;
int GLObject::g_nHandleCounter = 1;

/////////////////////////////////////////////////////////////////////////////////
GLObject::GLObject()
    : m_sObjectName("unnamed-object"), m_bVisible(true), m_bPerceptable(true),
      m_T_pc(Eigen::Matrix4d::Identity()), m_bIs2dLayer(false)
{
    Init();
}

/////////////////////////////////////////////////////////////////////////////////
GLObject::GLObject( const std::string& name)
    : m_sObjectName(name), m_bVisible(true), m_bPerceptable(true),
      m_T_pc(Eigen::Matrix4d::Identity()), m_bIs2dLayer(false)
{
    Init();
}

/////////////////////////////////////////////////////////////////////////////////
GLObject::GLObject( const GLObject& rhs )
{
    *this = rhs;
}

/////////////////////////////////////////////////////////////////////////////////////////////////
void GLObject::Init()
{
    m_dPosition.setZero();
}

/////////////////////////////////////////////////////////////////////////////////////////////////
int GLObject::AllocSelectionId()
{
    int handle = g_nHandleCounter++;
    g_mObjects[ handle ] = this;
    return handle;
}

/////////////////////////////////////////////////////////////////////////////////////////////////
void GLObject::DrawObjectAndChildren()
{
    glMatrixMode(GL_MODELVIEW);
    glPushMatrix();
    glMultMatrixd(m_T_pc.data());

    DrawCanonicalObject();

    for(std::vector<GLObject*>::const_iterator i=m_vpChildren.begin(); i!= m_vpChildren.end(); ++i)
    {
        (*i)->DrawObjectAndChildren();
    }

    glPopMatrix();
}

/////////////////////////////////////////////////////////////////////////////////
void GLObject::SetVisible(bool visible)
{
    m_bVisible = visible;
}

/////////////////////////////////////////////////////////////////////////////////
bool GLObject::IsVisible()
{
    return m_bVisible;
}

/////////////////////////////////////////////////////////////////////////////////
bool GLObject::IsPerceptable()
{
    return m_bPerceptable;
}

/////////////////////////////////////////////////////////////////////////////////
void GLObject::SetPerceptable( bool bPerceptable )
{
    m_bPerceptable = bPerceptable;
}

/////////////////////////////////////////////////////////////////////////////////
void GLObject::SetObjectName( const std::string& sName )
{
    m_sObjectName = sName;
}

/////////////////////////////////////////////////////////////////////////////////
const std::string& GLObject::ObjectName() const
{
    return m_sObjectName;
}

/////////////////////////////////////////////////////////////////////////////////
void GLObject::AddChild( GLObject* pChild )
{
    m_vpChildren.push_back( pChild );
}

/////////////////////////////////////////////////////////////////////////////////
size_t GLObject::NumChildren() const
{
    return m_vpChildren.size();
}

/////////////////////////////////////////////////////////////////////////////////
GLObject& GLObject::operator[](int i)
{
    return *m_vpChildren[i];
}

/////////////////////////////////////////////////////////////////////////////////
const GLObject& GLObject::operator[](int i) const
{
    return *m_vpChildren[i];
}

///////////////////////////////////////////////////////////////////////////////////////////
Eigen::Vector6d GLObject::GetPose()
{
    return m_dPosition;
}


///////////////////////////////////////////////////////////////////////////////////////////
Eigen::Vector6d& GLObject::GetPoseRef()
{
    return m_dPosition;
}


////////////////////////////////////////////////////////////////////////////////////////////
void GLObject::SetPose(Eigen::Vector6d v)
{
    m_dPosition = v;
}


/////////////////////////////////////////////////////////////////////////////////////////////////
void GLObject::SetPose(double x, double y, double z, double p, double q, double r)
{
    m_dPosition[0] = x;
    m_dPosition[1] = y;
    m_dPosition[2] = z;
    m_dPosition[3] = p;
    m_dPosition[4] = q;
    m_dPosition[5] = r;
}


} // SceneGraph
